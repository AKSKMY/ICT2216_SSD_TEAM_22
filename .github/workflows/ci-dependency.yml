name: OWASP Dependency Check (Push Only)

on:
  push:
    branches: [main]
  pull_request:
    branches: [main] 

jobs:
  depcheck:
    runs-on: ubuntu-22.04

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Run OWASP Dependency Check with Docker
      run: |
        mkdir -p odc-reports
        export DATA_DIR=$(mktemp -d)
        docker run --rm \
          -v ${{ github.workspace }}/backend:/src \
          -v ${{ github.workspace }}/odc-reports:/report \
          -v "$DATA_DIR:/usr/share/dependency-check/data" \
          owasp/dependency-check \
          --scan /src \
          --format HTML \
          --enableRetired \
          --out /report

    - name: Upload Dependency Check Report
      uses: actions/upload-artifact@v4
      with:
        name: Dependency-Check-Report
        path: odc-reports
